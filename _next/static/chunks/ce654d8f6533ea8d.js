(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,44168,e=>{"use strict";var t=e.i(43476),r=e.i(71645);e.i(76861);var s=e.i(76036),i=e.i(82908),a=e.i(45158),n=e.i(60103),c=e.i(50292),l=e.i(2438),d=e.i(93242),x=e.i(59434),o=e.i(27194),m=e.i(22315);function u(){let[e,u]=(0,r.useState)([]),[h,p]=(0,r.useState)(!0),[f,g]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!0),y=(0,r.useRef)(0),S=(0,r.useRef)(!1),R=(0,r.useRef)(!0),k=(0,r.useRef)(null),w=(0,r.useCallback)(async()=>{if(S.current||!R.current)return;S.current=!0;let e=0===y.current;e?p(!0):g(!0);let t=y.current;try{let e=(await a.api.get(s.API_ROUTES.INVECTOR.PERSONAL_TRANSACTIONS,{params:{offset:t,limit:10}})).data||[];0===e.length?(R.current=!1,N(!1)):(u(t=>[...t,...e]),y.current+=e.length,e.length<10&&(R.current=!1,N(!1)))}catch(e){R.current=!1,N(!1),b(!0)}finally{S.current=!1,e?p(!1):g(!1)}},[]);(0,r.useEffect)(()=>{w()},[w]),(0,r.useEffect)(()=>{if(!v||0===e.length)return;let t=k.current;if(!t)return;let r=new IntersectionObserver(e=>{e[0].isIntersecting&&R.current&&!S.current&&w()},{threshold:.1,rootMargin:"100px"});return r.observe(t),()=>{r.disconnect()}},[w,v,e.length]);let O=e=>e.toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}),T=(0,r.useMemo)(()=>{let t={};return e.forEach(e=>{let r=(0,m.default)(e.time).format("YYYY-MM-DD");t[r]||(t[r]=[]),t[r].push(e)}),Object.entries(t).sort(([e],[t])=>t.localeCompare(e)).map(([e,t])=>({date:(0,m.default)(e).format("DD.MM.YYYY"),transactions:t}))},[e]),Y=i.InvectorProducts["personal-deals"],E=i.InvectorSubscriptions["subscription-premium"];return(0,t.jsxs)("div",{className:"bg-background text-foreground font-sans antialiased min-h-screen",children:[(0,t.jsx)(n.default,{}),(0,t.jsx)("main",{className:"pt-20 pb-16",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full",children:(0,t.jsxs)(o.default,{isLoading:h,hasError:j,preview:Y&&E?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(x.default,{product:Y,subscription:E})}):null,children:[(0,t.jsxs)("div",{className:"text-center mb-12 mt-12",children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-5xl font-bold mb-4 text-heading px-2",children:"Мои личные сделки"}),(0,t.jsx)("p",{className:"text-base sm:text-lg md:text-xl text-foreground/80 max-w-3xl mx-auto px-2",children:"История открытых и закрытых сделок на фондовом рынке"}),(0,t.jsx)("div",{className:"mt-6 px-2",children:(0,t.jsx)(l.default,{})})]}),0!==e.length||h?(0,t.jsxs)("div",{className:"space-y-6",children:[T.map(e=>(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"sticky top-20 z-10 bg-background/95 backdrop-blur-sm py-2",children:(0,t.jsx)("h2",{className:"text-xl font-semibold text-heading",children:e.date})}),e.transactions.map((e,r)=>{let s,i=!!(e.exchange&&e.ticker),a=void 0!==e.profit;return(0,t.jsx)("div",{className:"bg-card rounded-xl p-4 border border-primary/10 hover:border-primary/30 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,t.jsx)(d.default,{exchange:e.exchange,ticker:e.ticker,hasLogo:i}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("div",{className:"font-semibold text-heading text-lg",children:e.ticker}),(0,t.jsx)("div",{className:`px-2 py-1 rounded text-xs font-semibold ${a?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"}`,children:a?"Закрытие":"Открытие"})]}),e.description&&(0,t.jsx)("div",{className:"text-sm text-foreground/60 line-clamp-2",children:e.description})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-heading mb-1",children:[O(e.price)," ₽"]}),(0,t.jsxs)("div",{className:"space-y-1",children:[a&&void 0!==e.profit&&(s=e.price*e.count*(e.profit/100),(0,t.jsxs)("div",{className:`text-sm ${e.profit>=0?"text-green-500":"text-red-500"}`,children:["Прибыль:"," ",e.profit>=0?"+":"",O(s)," ₽ /"," ",e.profit>=0?"+":"",e.profit.toFixed(2),"%"]})),(0,t.jsxs)("div",{className:"text-xs text-foreground/60",children:["Количество: ",e.count.toLocaleString("ru-RU")]}),(0,t.jsxs)("div",{className:"text-xs text-foreground/60",children:["Сумма:"," ",O(e.price*e.count)," ","₽"]})]})]})]})},`${e.ticker}-${e.time}-${r}`)})]},e.date)),(0,t.jsx)("div",{ref:k,className:v?"h-20":"h-0"}),f&&(0,t.jsxs)("div",{className:"flex justify-center items-center gap-3 py-8",children:[(0,t.jsx)("span",{className:"inline-block h-6 w-6 animate-spin rounded-full border-2 border-primary/30 border-t-primary"}),(0,t.jsx)("div",{className:"text-heading",children:"Загрузка..."})]}),!v&&e.length>0&&(0,t.jsx)("div",{className:"text-center py-8 text-foreground/60",children:"Все сделки загружены"})]}):(0,t.jsx)("div",{className:"text-center py-12 text-foreground/60 bg-card rounded-xl",children:"Нет сделок"})]})})}),(0,t.jsx)(c.default,{})]})}e.s(["default",()=>u,"dynamic",0,"force-static"])}]);